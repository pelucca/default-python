name: Validate Branch Merge

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
    branches:
      - main
      - dev
      - release/**

jobs:
  validate-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Check branch merge direction
        run: |
          echo "üîç Validating merge direction..."
          SOURCE_BRANCH="${{ github.head_ref }}"
          TARGET_BRANCH="${{ github.base_ref }}"

          echo "Source: $SOURCE_BRANCH ‚Üí Target: $TARGET_BRANCH"

          # Regra 1: feature/* s√≥ pode ir pra dev
          if [[ "$SOURCE_BRANCH" == feature/* && "$TARGET_BRANCH" != "dev" ]]; then
            echo "‚ùå Features s√≥ podem ser mergeadas em dev."
            exit 1
          fi

          # Regra 2: dev s√≥ pode ir pra release/*
          if [[ "$SOURCE_BRANCH" == "dev" && "$TARGET_BRANCH" != release/* ]]; then
            echo "‚ùå Dev s√≥ pode ser mergeado em release/*."
            exit 1
          fi

          # Regra 3: release/* s√≥ pode ir pra main
          if [[ "$SOURCE_BRANCH" == release/* && "$TARGET_BRANCH" != "main" ]]; then
            echo "‚ùå Release s√≥ pode ser mergeada em main."
            exit 1
          fi

          echo "‚úÖ Merge direction is valid!"
